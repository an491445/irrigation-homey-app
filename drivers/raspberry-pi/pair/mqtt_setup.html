<script type="text/javascript">
  Homey.setTitle("Pair Raspberry Pi");

  function connect() {
    let host = document.getElementById('host').value;
    let port = document.getElementById('port').value;
    if (!host || !port) {
      return Homey.alert('Please fill in all fields');
    }
    Homey.showLoadingOverlay();

    // Register devices
    Homey.createDevice({
      data: {
        id: "pi-sensors",
      },
      name: "Pi sensors",
      capabilities: [
        "measure_humidity.AM2320",
        "measure_temperature.AM2320",
        "measure_pressure.BMP280",
        "measure_temperature.BMP280",
        "meter_water.HCSR04",
        "measure_luminance.TSL2561",
      ],
      capabilitiesOptions: {
        "measure_humidity.AM2320": {
          title: { en: "Humidity (AM2320)" }
        },
        "measure_temperature.AM2320": {
          title: { en: "Temperature (AM2320)" }
        },
        "measure_pressure.BMP280": {
          title: { en: "Pressure (BMP280)" }
        },
        "measure_temperature.BMP280": {
          title: { en: "Temperature (BMP280)" }
        },
        "meter_water.HCSR04": {
          title: { en: "Water level (HCSR04)" }
        },
        "measure_luminance.TSL2561": {
          title: { en: "Luminance (TSL2561)" }
        },
      },
      settings: { host, port },
    }, err => {
      Homey.hideLoadingOverlay();
      if (err) {
        Homey.alert(err);
      } else {
        Homey.done();
      }
    });
  }
</script>

<form>
  <label for="host">MQTT host</label>
  <input type="text" id="host" name="host" /><br />
  <label for="port">MQTT Port</label>
  <input type="text" id="port" name="port" /><br /><br />
  <button type="button" onclick="connect()">Connect</button>
</form>
